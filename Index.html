<!DOCTYPE html>
<html lang="lv">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>A-Frame + Spark + Extras</title>

    <script type="importmap">
      {
        "imports": {
          "three": "https://cdn.jsdelivr.net/npm/super-three@0.177.0/build/three.module.js",
          "aframe": "https://aframe.io/releases/1.7.1/aframe.module.min.js",
          "@sparkjsdev/spark": "https://sparkjs.dev/releases/spark/0.1.8/spark.module.js"
        }
      }
    </script>
  </head>

  <body>
    <div id="app"></div>

    <script type="module">
      import AFRAME from "aframe";
      import { SplatMesh, SparkRenderer } from "@sparkjsdev/spark";

      // expose AFRAME globally for extras + physics
      window.AFRAME = AFRAME;

      // load aframe-extras AFTER AFRAME exists
      await new Promise((resolve) => {
        const s = document.createElement("script");
        s.src =
          "https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.6.1/dist/aframe-extras.min.js";
        s.onload = resolve;
        document.head.appendChild(s);
      });

      // load physics system
      await new Promise((resolve) => {
        const s = document.createElement("script");
        s.src =
          "https://cdn.jsdelivr.net/npm/aframe-physics-system@4.0.1/dist/aframe-physics-system.min.js";
        s.onload = resolve;
        document.head.appendChild(s);
      });

      // Spark splat component
      AFRAME.registerComponent("splat", {
        schema: { src: { default: "" } },
        init() {
          const splat = new SplatMesh({ url: this.data.src });
          splat.quaternion.set(1, 0, 0, 0);
          this.el.setObject3D("mesh", splat);
        }
      });

      // Spark renderer system
      AFRAME.registerSystem("splat", {
        init() {
          const sparkRenderer = new SparkRenderer({ renderer: this.el.renderer });
          this.sceneEl.object3D.add(sparkRenderer);
        }
      });

      // create scene AFTER everything is registered
      document.querySelector("#app").innerHTML = `
        <a-scene physics="debug: false" background="color: black" xr-mode-ui="enabled: true">

          <a-assets>
            <a-asset-item id="navmesh-glb" src="objects/Pottery_collider.glb"></a-asset-item>
          </a-assets>

          <!-- PLAYER (aframe-extras movement) -->
          <a-entity
            id="rig"
            position="0.362 0 0.496"
            rotation="0 47.561 0"
            movement-controls="speed: 0.15; constrainToNavMesh: true"
            dynamic-body="shape: sphere; sphereRadius: 0.3; mass: 0"
          >
            <a-entity camera look-controls position="0 1.6 0"></a-entity>

        <a-entity id="leftHand" hand-tracking-grab-controls="hand: left;" oculus-touch-controls="hand: left" grab-controls="hand: left;"></a-entity>
        <a-entity id="rightHand" hand-tracking-grab-controls="hand: right;" oculus-touch-controls="hand: right" grab-controls="hand: right;"></a-entity>
          </a-entity>

          <!-- WORLD -->
          <a-entity
            id="world-container"
            position="0 -0.1 0"
            rotation="180 0 0"
            scale="2 2 2"
          >

            <!-- NAVMESH (aframe-extras) -->
<a-entity 
gltf-model="objects/Pottery_collider.glb" 
nav-mesh="" visible="false" 
position="0 -2.63945 3.449" 
scale="0.9 1 0.98">
</a-entity>

<!-- COLLIDER (physics) -->
<a-entity
gltf-model="#navmesh-glb"
static-body="shape: mesh"
visible="false"
></a-entity>

<!-- SPLAT -->
<a-entity
splat="src: objects/pottery.spz" 
scale="1 0.7 1">
</a-entity>

    <!-- POTTERY WHEEL AND VASE -->
    <a-entity position="-0.58 -0.5 0.58">
    <a-entity gltf-model="objects/potters_wheel.glb" 
    position="-0.0065 -0.04283 2.90938" 
    scale="0.9 0.9 0.9" 
    rotation="176 180 0"
    static-body="shape: box">
    </a-entity>
              
<a-entity 
gltf-model="objects/ozolins_2_fake.glb" 
position="-0.78472 0.01385 -0.93549" 
rotation="180 0 0" scale="0.25 0.25 0.25" 
dynamic-body="mass: 0.5; shape: box">
</a-entity>
            
              </a-entity>

          </a-entity>

        </a-scene>
      `;
    </script>
  </body>
</html>